rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {

    // =========================================================================
    // MEDIA FOLDER - Newsletter Images and Assets
    // =========================================================================

    match /media/{fileName} {
      // Anyone can read media files (public access for newsletter images)
      allow read: if true;

      // Only authenticated users can upload media
      // Restrictions:
      // - Must be authenticated
      // - File size limit: 10MB
      // - Must be an image file
      allow write: if request.auth != null &&
                     request.resource.size < 10 * 1024 * 1024 &&
                     request.resource.contentType.matches('image/.*');

      // Only authenticated users can delete their own uploads
      // Site Admins can delete any media
      allow delete: if request.auth != null;
    }

    // =========================================================================
    // DEFAULT DENY - All Other Paths
    // =========================================================================

    // Deny access to any other storage paths not explicitly allowed
    match /{allPaths=**} {
      allow read, write: if false;
    }
  }
}
